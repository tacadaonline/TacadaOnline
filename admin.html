<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>TACADA ONLINE - DASHBOARD SUPREMO</title>
    <style>
        body { background: #050505; color: gold; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #111; border: 2px solid gold; border-radius: 15px; padding: 25px; }
        .section { margin-bottom: 20px; padding: 20px; background: #1a1a1a; border-radius: 10px; border-left: 5px solid gold; }
        input { padding: 10px; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; margin: 5px; }
        button { padding: 10px 20px; background: gold; color: #000; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #333; text-align: left; }
        .btn-add { background: #2196F3; color: white; margin-left: 5px; }
        .btn-pay { background: #00c853; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h1>Controle Geral üé±</h1>

    <div class="section">
        <h3>Configura√ß√µes Globais</h3>
        <input type="password" id="sAdmin" placeholder="Senha Admin">
        <input type="number" id="vRtp" step="0.1" placeholder="Novo RTP (Ex: 0.5)">
        <button onclick="salvarRTP()">Mudar Dificuldade</button>
    </div>

    <div class="section">
        <h3>Gest√£o de Jogadores</h3>
        <button onclick="listarUsuarios()">Listar Todos os Jogadores</button>
        <table id="tabelaUsers">
            <thead>
                <tr>
                    <th>USU√ÅRIO</th>
                    <th>SALDO</th>
                    <th>DEP√ìSITO BASE</th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="listaCorpo"></tbody>
        </table>
    </div>
</div>

<script>
    const passInput = document.getElementById("sAdmin");

    async function salvarRTP() {
        const res = await fetch("/admin/set-rtp", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ novoRTP: document.getElementById("vRtp").value, senha: passInput.value })
        });
        const data = await res.json();
        alert(data.success ? "RTP Alterado!" : "Erro!");
    }

    async function listarUsuarios() {
        const res = await fetch("/admin/usuarios", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ senha: passInput.value })
        });
        const data = await res.json();
        if(data.success) {
            const corpo = document.getElementById("listaCorpo");
            corpo.innerHTML = "";
            data.usuarios.forEach(u => {
                corpo.innerHTML += `
                    <tr>
                        <td>${u.username}</td>
                        <td style="color: #0f0;">R$ ${u.saldo.toFixed(2)}</td>
                        <td>R$ ${u.depositoInicial.toFixed(2)}</td>
                        <td>
                            <button class="btn-add" onclick="addSaldo('${u.username}')">+ Add Saldo</button>
                            <button class="btn-pay" onclick="pagar('${u.username}')">Zerar Saldo (Pago)</button>
                        </td>
                    </tr>
                `;
            });
        }
    }

    async function addSaldo(user) {
        const valor = prompt(`Quanto de saldo deseja adicionar para ${user}?`);
        if(!valor) return;
        const res = await fetch("/admin/add-saldo", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username: user, valor: valor, senha: passInput.value })
        });
        const data = await res.json();
        if(data.success) { alert("Saldo Adicionado!"); listarUsuarios(); }
    }

    async function pagar(user) {
        if(!confirm(`Zerar o saldo de ${user}?`)) return;
        const res = await fetch("/admin/pagar-saque", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username: user, senha: passInput.value })
        });
        const data = await res.json();
        if(data.success) listarUsuarios();
    }
</script>
</body>
</html>
