<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD SUPREMO</title>
    <style>
        :root { --gold: #ffd700; --dark: #0a0a0a; }
        body { background: #050505; color: var(--gold); font-family: sans-serif; padding: 20px; }
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { background: #222; border: 1px solid #444; color: #888; padding: 10px; cursor: pointer; border-radius: 5px; }
        .tab-btn.active { background: var(--gold); color: #000; font-weight: bold; }
        .tab-content { display: none; background: #111; padding: 20px; border-radius: 10px; border: 1px solid var(--gold); }
        .tab-content.active { display: block; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; }
        button { padding: 10px; background: var(--gold); border: none; cursor: pointer; font-weight: bold; width: 100%; border-radius: 5px; margin-top: 5px;}
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 10px; border-bottom: 1px solid #222; text-align: left; }
    </style>
</head>
<body>

    <h2 style="text-align:center">üé± PAINEL DE CONTROLE</h2>
    
    <div style="text-align:center; margin-bottom:20px;">
        <input type="password" id="sAdmin" style="max-width:300px" placeholder="Senha Mestra">
    </div>

    <div class="tab-menu">
        <button class="tab-btn active" onclick="openTab('config')">‚öôÔ∏è Config</button>
        <button class="tab-btn" onclick="openTab('jogadores')">üë• Jogadores</button>
        <button class="tab-btn" onclick="openTab('saques')">üí∏ Saques</button>
        <button class="tab-btn" onclick="openTab('api')">üîë API Pagamento</button>
    </div>

    <div id="config" class="tab-content active">
        <h3>Ajustar RTP (0.1 a 0.9)</h3>
        <input type="number" id="vRtp" step="0.05" placeholder="Ex: 0.30">
        <button onclick="salvarRTP()">SALVAR DIFICULDADE</button>
    </div>

    <div id="jogadores" class="tab-content">
        <h3>Lista de Usu√°rios <button onclick="listarUsers()" style="width:auto; float:right">üîÑ</button></h3>
        <table>
            <thead><tr><th>Usu√°rio</th><th>Saldo</th><th>Afiliado</th></tr></thead>
            <tbody id="listaUsers"></tbody>
        </table>
    </div>

    <div id="saques" class="tab-content">
        <h3>Saques Pendentes <button onclick="listarSaques()" style="width:auto; float:right">üîÑ</button></h3>
        <table>
            <thead><tr><th>Usu√°rio</th><th>Valor</th><th>Pix</th><th>A√ß√£o</th></tr></thead>
            <tbody id="listaSaques"></tbody>
        </table>
    </div>

    <div id="api" class="tab-content">
        <h3>Configurar Gateway (Sess√£o Segura)</h3>
        <p style="font-size:11px; color:#888">As chaves abaixo somem ao fechar o navegador.</p>
        <input type="text" id="apiID" placeholder="Client ID">
        <input type="password" id="apiSec" placeholder="Client Secret">
        <button onclick="salvarApiLocal()">ATIVAR API NESTA SESS√ÉO</button>
    </div>

    <script>
        function openTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        async function listarUsers() {
            const res = await fetch("/admin/usuarios", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ senha: document.getElementById("sAdmin").value })});
            const data = await res.json();
            if(data.success) {
                document.getElementById("listaUsers").innerHTML = data.usuarios.map(u => `<tr><td>${u.username}</td><td>R$ ${u.saldo.toFixed(2)}</td><td>${u.indicadoPor || 'Direto'}</td></tr>`).join('');
            }
        }

        async function listarSaques() {
            const res = await fetch("/admin/saques-pendentes", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ senha: document.getElementById("sAdmin").value })});
            const data = await res.json();
            if(data.success) {
                document.getElementById("listaSaques").innerHTML = data.saques.map(s => `<tr><td>${s.username}</td><td>R$ ${s.valor}</td><td>${s.chavePix}</td><td><button onclick="pagar('${s.chavePix}', ${s.valor})" style="background:green; color:white">PAGAR</button></td></tr>`).join('');
            }
        }

        function salvarApiLocal() {
            sessionStorage.setItem("api_id", document.getElementById("apiID").value);
            sessionStorage.setItem("api_sec", document.getElementById("apiSec").value);
            alert("‚úÖ API de Pagamento ativada para esta aba!");
        }

        function pagar(pix, valor) {
            const id = sessionStorage.getItem("api_id");
            if(!id) return alert("‚ùå Primeiro configure a aba API!");
            alert(`Processando R$ ${valor} para o PIX ${pix} usando as chaves salvas...`);
        }

        async function salvarRTP() {
            const res = await fetch("/admin/set-rtp", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({ rtp: document.getElementById("vRtp").value, senha: document.getElementById("sAdmin").value })});
            const data = await res.json();
            alert(data.success ? "RTP Alterado!" : "Erro!");
        }
    </script>
</body>
</html>
