<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Sinuca Gold Pro – Final Version</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; }
  body { background: #050505; color: gold; font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
  
  .header { width: 100%; padding: 15px; background: linear-gradient(180deg, #1a1a1a 0%, #000 100%); border-bottom: 2px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
  .stat-label { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
  .stat-value { color: #fff; font-weight: bold; font-size: 20px; display: block; }
  
  #bet-panel { margin: 15px; display: flex; gap: 8px; }
  .bet-btn { padding: 10px 16px; background: #222; border: 1px solid #444; color: #aaa; border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: bold; }
  .bet-btn.active { color: #000; border-color: gold; background: gold; box-shadow: 0 0 15px rgba(255,215,0,0.3); }
  
  #confirm { margin-bottom: 15px; padding: 12px 40px; background: #00c853; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }

  canvas { 
    background: radial-gradient(circle, #1a7a3d 0%, #0b4d24 100%); 
    border: 12px solid #3e2723; border-radius: 8px; 
    box-shadow: inset 0 0 50px rgba(0,0,0,0.5), 0 10px 30px rgba(0,0,0,0.8);
  }

  #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; display: none; font-weight: 900; z-index: 10; text-align: center; text-shadow: 0 0 20px #000; pointer-events: none; }
</style>
</head>
<body>

<div class="header">
  <div><span class="stat-label">Saldo</span><span id="saldo" class="stat-value">R$ 1000.00</span></div>
  <div><span class="stat-label">Aposta</span><span id="bet" class="stat-value">R$ 10.00</span></div>
  <div><span class="stat-label">Tempo</span><span id="tempo" class="stat-value" style="color:#ff4444">3.00</span></div>
</div>

<div id="bet-panel">
  <button class="bet-btn active" onclick="selectBet(10,this)">R$10</button>
  <button class="bet-btn" onclick="selectBet(20,this)">R$20</button>
  <button class="bet-btn" onclick="selectBet(50,this)">R$50</button>
  <button class="bet-btn" onclick="selectBet(100,this)">R$100</button>
</div>

<button id="confirm" onclick="confirmBet()">Confirmar Aposta</button>

<canvas id="game"></canvas>
<div id="msg"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth * 0.94;
canvas.height = canvas.width * 0.75;

const saldoEl = document.getElementById("saldo");
const betEl = document.getElementById("bet");
const tempoEl = document.getElementById("tempo");
const msgEl = document.getElementById("msg");

let saldo = 1000;
let betValue = 10;
let lockedBet = 0;
let state = "BETTING"; 
let time = 3;
let timerIniciado = false;

function ball(x, y, c) { return { x, y, vx: 0, vy: 0, r: 10, color: c }; }

let branca, dourada, hole;

function sortearPosicoes() {
    const margin = 20; // Posição bem no canto
    const cantos = [
        {x: margin, y: margin},
        {x: canvas.width - margin, y: margin},
        {x: margin, y: canvas.height - margin},
        {x: canvas.width - margin, y: canvas.height - margin}
    ];
    const indexCanto = Math.floor(Math.random() * 4);
    // CAÇAPA REDUZIDA PARA 15 (Mais difícil)
    hole = { ...cantos[indexCanto], r: 15 };

    const offsetX = (hole.x < canvas.width/2) ? canvas.width * 0.6 : canvas.width * 0.4;
    const offsetY = (hole.y < canvas.height/2) ? canvas.height * 0.6 : canvas.height * 0.4;
    dourada = ball(offsetX + (Math.random()*40-20), offsetY + (Math.random()*40-20), "#ffd700");

    const bX = (hole.x < canvas.width/2) ? canvas.width * 0.8 : canvas.width * 0.2;
    const bY = (hole.y < canvas.height/2) ? canvas.height * 0.8 : canvas.height * 0.2;
    branca = ball(bX, bY, "#fff");
}

sortearPosicoes();

function selectBet(v, btn) {
  if (state !== "BETTING") return;
  betValue = v;
  betEl.innerText = `R$ ${v.toFixed(2)}`;
  document.querySelectorAll(".bet-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
}

function confirmBet() {
  if (state !== "BETTING") return;
  if (saldo < betValue) { show("SALDO INSUFICIENTE", "#ff4444"); return; }
  lockedBet = betValue;
  saldo -= lockedBet;
  saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;
  state = "PLAYING";
  document.getElementById("confirm").style.opacity = "0.5";
  show("BOA SORTE!", "gold");
}

let startPos = { x: 0, y: 0 }, power = 0, angle = 0, charging = false;

canvas.addEventListener("touchstart", e => {
  if (state !== "PLAYING") return;
  e.preventDefault();
  const touch = e.touches[0];
  startPos = { x: touch.clientX, y: touch.clientY };
  charging = true;
  timerIniciado = true; 
}, { passive: false });

canvas.addEventListener("touchmove", e => {
  if (!charging) return;
  e.preventDefault();
  const touch = e.touches[0];
  let dx = startPos.x - touch.clientX;
  let dy = startPos.y - touch.clientY;
  angle = Math.atan2(dy, dx);
  power = Math.min(Math.hypot(dx, dy) / 1.5, 100);
}, { passive: false });

canvas.addEventListener("touchend", e => {
  if (!charging) return;
  e.preventDefault();
  charging = false;
  branca.vx = Math.cos(angle) * (power / 5.5);
  branca.vy = Math.sin(angle) * (power / 5.5);
  power = 0;
}, { passive: false });

function update() {
  if (state === "PLAYING" && timerIniciado) {
    time -= 1/60;
    tempoEl.innerText = Math.max(0, time).toFixed(2);
    if (time <= 0) finish(false, "TEMPO ESGOTADO");
  }

  [branca, dourada].forEach(b => {
    b.x += b.vx; b.y += b.vy;
    b.vx *= 0.988; b.vy *= 0.988;
    if (Math.abs(b.vx) < 0.1) b.vx = 0;
    if (Math.abs(b.vy) < 0.1) b.vy = 0;
    if (b.x - b.r < 0 || b.x + b.r > canvas.width) b.vx *= -0.8;
    if (b.y - b.r < 0 || b.y + b.r > canvas.height) b.vy *= -0.8;
  });

  let dx = dourada.x - branca.x;
  let dy = dourada.y - branca.y;
  if (Math.hypot(dx, dy) < branca.r + dourada.r) {
    let a = Math.atan2(dy, dx);
    let v = Math.hypot(branca.vx, branca.vy);
    dourada.vx = Math.cos(a) * v * 0.95;
    dourada.vy = Math.sin(a) * v * 0.95;
    branca.vx *= -0.3; branca.vy *= -0.3;
  }

  // Detecção de caçapa mais precisa
  if (Math.hypot(dourada.x - hole.x, dourada.y - hole.y) < hole.r) finish(true);
  if (state === "PLAYING" && timerIniciado && !charging && branca.vx === 0 && dourada.vx === 0) finish(false, "ERROU");
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Caçapa
  ctx.fillStyle = "#000";
  ctx.beginPath(); ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI * 2); ctx.fill();

  // Mira
  if (charging && state === "PLAYING") {
    ctx.beginPath(); ctx.setLineDash();
    ctx.moveTo(branca.x, branca.y);
    ctx.lineTo(branca.x + Math.cos(angle) * (power * 1.5), branca.y + Math.sin(angle) * (power * 1.5));
    ctx.strokeStyle = "rgba(255, 255, 255, 0.4)";
    ctx.stroke(); ctx.setLineDash([]);
  }

  // Bolas
  [branca, dourada].forEach(b => {
    let grad = ctx.createRadialGradient(b.x-2, b.y-2, 1, b.x, b.y, b.r);
    grad.addColorStop(0, "#fff"); grad.addColorStop(1, b.color);
    ctx.fillStyle = grad;
    ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2); ctx.fill();
  });
}

function finish(win, msg) {
  if (state !== "PLAYING") return;
  state = "RESULT";
  if (win) {
    let gain = lockedBet * 2;
    saldo += gain;
    show(`+ R$ ${gain.toFixed(2)}`, "gold");
  } else { show(msg || "PERDEU", "#ff4444"); }
  saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;
  setTimeout(reset, 1500);
}

function reset() {
  sortearPosicoes();
  time = 3; tempoEl.innerText = "3.00"; timerIniciado = false;
  state = "BETTING";
  document.getElementById("confirm").style.opacity = "1";
}

function show(t, c) {
  msgEl.innerText = t; msgEl.style.color = c; msgEl.style.display = "block";
  setTimeout(() => msgEl.style.display = "none", 1500);
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
