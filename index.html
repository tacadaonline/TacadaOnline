<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TACADA ONLINE</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; }
  body { background: #050505; color: gold; font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
  
  .header { width: 100%; padding: 10px; display: flex; justify-content: space-around; background: linear-gradient(180deg, #1a1a1a 0%, #000 100%); border-bottom: 2px solid #333; }
  .stat-box { text-align: center; }
  .stat-label { font-size: 10px; color: #888; text-transform: uppercase; }
  .stat-value { color: #fff; font-weight: bold; font-size: 16px; display: block; }

  #bet-panel { margin: 10px; display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
  .bet-btn, #custom-bet { padding: 8px 12px; background: #222; border: 1px solid #444; color: #aaa; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px; }
  .active-bet { color: #000 !important; border-color: gold !important; background: gold !important; }
  #custom-bet { width: 70px; color: #fff; text-align: center; outline: none; }

  #confirm { margin-bottom: 10px; padding: 12px 30px; background: #00c853; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; width: 80%; max-width: 300px; }
  
  #canvas-container { position: relative; width: 95vw; max-width: 500px; aspect-ratio: 4/3; }
  canvas { width: 100%; height: 100%; background: radial-gradient(circle, #0e4422 0%, #052b14 100%); border: 8px solid #3e2723; border-radius: 12px; box-shadow: inset 0 0 40px rgba(0,0,0,0.8); display: block; }
  
  #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; display: none; font-weight: 900; z-index: 10; text-align: center; text-shadow: 2px 2px 10px #000; pointer-events: none; white-space: nowrap; }
</style>
</head>
<body>

<div class="header">
  <div class="stat-box"><span class="stat-label">Saldo</span><span id="saldo" class="stat-value">R$ 1000.00</span></div>
  <div class="stat-box"><span class="stat-label">Retorno</span><span id="lucro" class="stat-value" style="color:#0f0">R$ 20.00</span></div>
  <div class="stat-box"><span class="stat-label">Tempo</span><span id="tempo" class="stat-value" style="color:#ff4444">2.50</span></div>
</div>

<div id="bet-panel">
  <button class="bet-btn active-bet" onclick="selectBet(10,this)">R$ 10</button>
  <button class="bet-btn" onclick="selectBet(20,this)">R$ 20</button>
  <button class="bet-btn" onclick="selectBet(50,this)">R$ 50</button>
  <input type="number" id="custom-bet" placeholder="VALOR" onfocus="selectCustom()" oninput="updateCustom(this.value)">
</div>

<button id="confirm" onclick="confirmBet()">Confirmar Aposta</button>

<div id="canvas-container">
    <canvas id="game"></canvas>
    <div id="msg"></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const saldoEl = document.getElementById("saldo"), lucroEl = document.getElementById("lucro"), tempoEl = document.getElementById("tempo"), msgEl = document.getElementById("msg");

// Ajuste de Resolução
function resize() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    sortearPosicoes();
}

let saldo = 1000.00, valorAposta = 10, state = "BETTING", time = 2.50, timerIniciado = false;
let branca = { x: 0, y: 0, vx: 0, vy: 0, r: 8 }, dourada = { x: 0, y: 0, vx: 0, vy: 0, r: 8 }, hole = { x: 0, y: 0, r: 12 };

function sortearPosicoes() {
    const margin = 15;
    hole.x = margin; hole.y = margin; // Caçapa no canto superior esquerdo
    dourada.x = canvas.width * 0.5; dourada.y = canvas.height * 0.5;
    branca.x = canvas.width * 0.8; branca.y = canvas.height * 0.7;
    branca.vx = 0; branca.vy = 0; dourada.vx = 0; dourada.vy = 0;
}

function show(txt, col) { msgEl.innerText = txt; msgEl.style.color = col; msgEl.style.display = "block"; setTimeout(() => msgEl.style.display = "none", 2000); }

function selectBet(v, btn) {
    if (state !== "BETTING") return;
    valorAposta = v;
    document.querySelectorAll('.bet-btn, #custom-bet').forEach(b => b.classList.remove('active-bet'));
    btn.classList.add('active-bet');
    lucroEl.innerText = `R$ ${(valorAposta * 2).toFixed(2)}`;
}

function confirmBet() {
    if (state !== "BETTING" || saldo < valorAposta) return;
    saldo -= valorAposta;
    saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;
    state = "PLAYING";
    time = 2.50;
    timerIniciado = false;
    sortearPosicoes();
    document.getElementById("confirm").style.opacity = "0.5";
}

// Input Touch
let startPos = { x: 0, y: 0 }, charging = false, angle = 0, power = 0;
canvas.addEventListener("touchstart", e => {
    if (state !== "PLAYING" || Math.abs(branca.vx) > 0.1) return;
    charging = true; timerIniciado = true;
    startPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
});

canvas.addEventListener("touchmove", e => {
    if (!charging) return;
    let dx = startPos.x - e.touches[0].clientX;
    let dy = startPos.y - e.touches[0].clientY;
    angle = Math.atan2(dy, dx);
    power = Math.min(Math.hypot(dx, dy) / 2, 40);
});

canvas.addEventListener("touchend", () => {
    if (!charging) return;
    charging = false;
    branca.vx = Math.cos(angle) * (power / 5);
    branca.vy = Math.sin(angle) * (power / 5);
});

function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Caçapa
    ctx.fillStyle = "#000";
    ctx.beginPath(); ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI*2); ctx.fill();

    if (state === "PLAYING" && timerIniciado) {
        time -= 1/60;
        tempoEl.innerText = Math.max(0, time).toFixed(2);
        if (time <= 0) finish(false);
    }

    [branca, dourada].forEach(b => {
        b.x += b.vx; b.y += b.vy;
        b.vx *= 0.98; b.vy *= 0.98; // Atrito
        
        if (b.x < b.r || b.x > canvas.width - b.r) b.vx *= -0.8;
        if (b.y < b.r || b.y > canvas.height - b.r) b.vy *= -0.8;
    });

    // Colisão Branca -> Dourada
    let d = Math.hypot(branca.x - dourada.x, branca.y - dourada.y);
    if (d < branca.r + dourada.r) {
        let a = Math.atan2(dourada.y - branca.y, dourada.x - branca.x);
        dourada.vx = Math.cos(a) * 3; dourada.vy = Math.sin(a) * 3;
    }

    // Vitória: Dourada na Caçapa
    if (Math.hypot(dourada.x - hole.x, dourada.y - hole.y) < hole.r) finish(true);

    // Desenhar Bolas
    ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(branca.x, branca.y, branca.r, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(dourada.x, dourada.y, dourada.r, 0, Math.PI*2); ctx.fill();

    // Linha de Mira
    if (charging) {
        ctx.strokeStyle = "rgba(255,255,255,0.3)";
        ctx.beginPath(); ctx.moveTo(branca.x, branca.y);
        ctx.lineTo(branca.x + Math.cos(angle)*power, branca.y + Math.sin(angle)*power);
        ctx.stroke();
    }

    requestAnimationFrame(update);
}

function finish(win) {
    if (state !== "PLAYING") return;
    state = "BETTING";
    timerIniciado = false;
    document.getElementById("confirm").style.opacity = "1";
    if (win) {
        saldo += valorAposta * 2;
        show("GANHOU! R$ " + (valorAposta*2), "#0f0");
    } else {
        show("PERDEU!", "#f00");
    }
    saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;
    setTimeout(sortearPosicoes, 2000);
}

window.addEventListener('resize', resize);
resize();
update();
</script>
</body>
</html>
