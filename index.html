<script>
/* ================= INÃCIO ================= */

/* ===== SOM ===== */
let somLigado = true;
let volumeGlobal = 0.6;

const somTacada  = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-billiard-ball-hit-2148.mp3");
const somColisao = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wood-hit-2152.mp3");
const somCaÃ§apa  = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3");
const somErro    = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3");
const somClique  = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3");

function tocar(audio){
    if(!somLigado) return;
    const s = audio.cloneNode();
    s.volume = volumeGlobal;
    s.play().catch(()=>{});
}

/* desbloqueia Ã¡udio no iOS */
document.body.addEventListener("touchstart", ()=>{
    tocar(somClique);
},{once:true});

/* ===== CONFIG ===== */
const multPagamento = 2.0;
const tempoJogo = 2.50;

/* ===== ELEMENTOS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth * 0.94;
canvas.height = canvas.width * 0.8;

const saldoEl = document.getElementById("saldo");
const lucroEl = document.getElementById("lucro");
const tempoEl = document.getElementById("tempo");
const msgEl = document.getElementById("msg");
const btnSom = document.getElementById("btnSom");

/* ===== ESTADO ===== */
let saldo = 1000;
let valorAposta = 10;
let lockedBet = 0;
let state = "BETTING";
let time = tempoJogo;

/* ===== BOLAS ===== */
let branca = {x:100,y:100,vx:0,vy:0,r:9,color:"#fff"};
let dourada = {x:200,y:200,vx:0,vy:0,r:9,color:"#ffd700"};
let hole = {x:50,y:50,r:11};

/* ===== SOM ON/OFF ===== */
btnSom.onclick = ()=>{
    somLigado = !somLigado;
    btnSom.innerText = somLigado ? "ðŸ”Š" : "ðŸ”‡";
};

/* ===== LUCRO ===== */
function atualizarLucro(){
    lucroEl.innerText = `R$ ${(valorAposta * multPagamento).toFixed(2)}`;
}
atualizarLucro();

/* ===== APOSTA ===== */
function confirmBet(){
    if(state !== "BETTING") return;
    if(valorAposta <= 0 || saldo < valorAposta){
        tocar(somErro);
        return;
    }

    tocar(somClique);
    lockedBet = valorAposta;
    saldo -= lockedBet;
    saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;

    state = "PLAYING";
    time = tempoJogo;
}

/* ===== RESULTADO ===== */
function finish(win){
    if(state !== "PLAYING") return;
    state = "RESULT";

    if(win){
        tocar(somCaÃ§apa);
        saldo += lockedBet * 2;
        show(`GREEN +R$ ${lockedBet.toFixed(2)}`,"gold");
    }else{
        tocar(somErro);
        show("LOSS","#ff4444");
    }

    saldoEl.innerText = `R$ ${saldo.toFixed(2)}`;
    setTimeout(reset,1500);
}

function reset(){
    state = "BETTING";
    time = tempoJogo;
}

/* ===== UI ===== */
function show(t,c){
    msgEl.innerText = t;
    msgEl.style.color = c;
    msgEl.style.display = "block";
    setTimeout(()=>msgEl.style.display="none",1200);
}

/* ================= FIM ================= */
</script>
