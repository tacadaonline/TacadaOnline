<script>
async function fazerLogin() {
    const user = document.getElementById('user').value.trim();
    const pass = document.getElementById('pass').value.trim();
    const erroEl = document.getElementById('erro');

    if (!user || !pass) {
        erroEl.style.color = "#ff4d4d";
        erroEl.innerText = "Preencha usuário e senha.";
        return;
    }

    const url = "https://tacadaonline-backend.onrender.com/login";

    erroEl.style.color = "gold";
    erroEl.innerText = "Conectando ao servidor...";

    try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 20000);

        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: user, password: pass }),
            signal: controller.signal
        });

        clearTimeout(timeout);

        let data;
        try {
            data = await response.json();
        } catch {
            throw new Error("Resposta inválida do servidor");
        }

        if (response.ok && data.success === true) {
            localStorage.setItem("saldoInicial", data.saldo ?? 0);
            window.location.href = "jogo.html";
        } else {
            erroEl.style.color = "#ff4d4d";
            erroEl.innerText = data.msg || "Login inválido.";
        }

    } catch (err) {
        console.error(err);
        erroEl.style.color = "#ff4d4d";
        erroEl.innerText = "Não foi possível conectar ao servidor. Tente novamente.";
    }
}
</script>
