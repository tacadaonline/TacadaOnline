<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sinuca Gold â€“ Tiro Livre</title>

<style>
body{
    margin:0;
    background: radial-gradient(circle,#111,#000);
    font-family: Arial Black, sans-serif;
    color: gold;
    display:flex;
    flex-direction:column;
    align-items:center;
    height:100vh;
    overflow:hidden;
}

header{
    margin-top:12px;
    text-align:center;
    text-shadow:0 0 10px gold;
}

canvas{
    background: linear-gradient(135deg,#0b5e28,#043314);
    border:10px solid #3e2723;
    border-radius:20px;
    margin-top:15px;
}

#forca{
    width:80%;
    height:16px;
    background:#222;
    border:2px solid gold;
    border-radius:10px;
    margin-top:12px;
    overflow:hidden;
}
#forcaFill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#ff0,#f00);
}

#msg{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:42px;
    display:none;
    text-shadow:0 0 20px gold;
}
</style>
</head>

<body>

<header>
Saldo: R$ <span id="saldo">100.00</span><br>
Aposta: R$ <input id="aposta" type="number" value="10" min="1">
</header>

<canvas id="game"></canvas>

<div id="forca"><div id="forcaFill"></div></div>

<div id="msg"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth * 0.9;
canvas.height = canvas.width * 0.55;

let saldo = 100;
let charging = false;
let power = 0;
let jogando = false;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function play(freq,time){
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value=freq;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.2,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+time);
    o.start(); o.stop(audioCtx.currentTime+time);
}

const whiteStartX = canvas.width*0.25;
const whiteStartY = canvas.height/2;

const bigStartX = canvas.width*0.7;
const bigStartY = canvas.height/2;

const white = {x:whiteStartX,y:whiteStartY,vx:0,vy:0,r:12};
const big = {x:bigStartX,y:bigStartY,vx:0,vy:0,r:20};
const pocket = {x:canvas.width*0.9,y:canvas.height/2,r:26};

function resetGame(){
    white.x=whiteStartX;
    white.y=whiteStartY;
    white.vx=white.vy=0;

    big.x=bigStartX;
    big.y=bigStartY;
    big.vx=big.vy=0;

    jogando=false;
}

function drawBall(b,color){
    ctx.fillStyle=color;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
}

function physics(b){
    b.x+=b.vx;
    b.y+=b.vy;
    b.vx*=0.97;
    b.vy*=0.97;

    // REBOTE NAS BORDAS
    if(b.x-b.r<=0 || b.x+b.r>=canvas.width){
        b.vx*=-1;
    }
    if(b.y-b.r<=0 || b.y+b.r>=canvas.height){
        b.vy*=-1;
    }
}

function collide(a,b){
    const dx=b.x-a.x;
    const dy=b.y-a.y;
    const dist=Math.hypot(dx,dy);

    if(dist<a.r+b.r){
        const ang=Math.atan2(dy,dx);
        const speed=Math.hypot(a.vx,a.vy);

        b.vx=Math.cos(ang)*speed;
        b.vy=Math.sin(ang)*speed;

        a.vx*=0.3;
        a.vy*=0.3;

        play(200,0.08);
    }
}

function showMsg(text){
    const msg=document.getElementById("msg");
    msg.innerText=text;
    msg.style.display="block";
    setTimeout(()=>msg.style.display="none",1200);
}

function checkEnd(){
    if(Math.abs(white.vx)<0.05 && Math.abs(big.vx)<0.05 && jogando){
        setTimeout(resetGame,800);
    }
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="#000";
    ctx.beginPath();
    ctx.arc(pocket.x,pocket.y,pocket.r,0,Math.PI*2);
    ctx.fill();

    drawBall(white,"#fff");
    drawBall(big,"#f44336");

    physics(white);
    physics(big);
    collide(white,big);

    // SE BOLÃƒO CAIR
    if(Math.hypot(big.x-pocket.x,big.y-pocket.y)<pocket.r){
        const aposta=Number(document.getElementById("aposta").value);
        saldo+=aposta*2;
        document.getElementById("saldo").innerText=saldo.toFixed(2);
        play(800,0.2);
        showMsg("GANHOU ðŸ’°");
        setTimeout(resetGame,800);
    }

    checkEnd();
    requestAnimationFrame(draw);
}

canvas.addEventListener("touchstart",()=>{
    if(!jogando){
        charging=true;
        power=0;
    }
});

canvas.addEventListener("touchend",()=>{
    if(!charging) return;
    charging=false;

    const aposta=Number(document.getElementById("aposta").value);
    if(saldo<aposta) return;

    saldo-=aposta;
    document.getElementById("saldo").innerText=saldo.toFixed(2);

    white.vx=power/4;
    white.vy=(Math.random()-0.5)*2;
    document.getElementById("forcaFill").style.width="0%";

    jogando=true;
    play(120,0.1);
});

setInterval(()=>{
    if(charging){
        power=Math.min(power+2,100);
        document.getElementById("forcaFill").style.width=power+"%";
    }
},30);

draw();
</script>
</body>
</html>
