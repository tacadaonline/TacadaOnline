<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TACADA ONLINE - OFICIAL</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: none; }
  body { background: #050505; color: gold; font-family: 'Segoe UI', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
  
  .header { width: 100%; padding: 10px; display: flex; justify-content: space-around; background: linear-gradient(180deg, #1a1a1a 0%, #000 100%); border-bottom: 2px solid #333; }
  .stat-box { text-align: center; }
  .stat-label { font-size: 10px; color: #888; text-transform: uppercase; }
  .stat-value { color: #fff; font-weight: bold; font-size: 18px; display: block; }
  
  #bet-panel { margin: 10px; display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; }
  .bet-btn, #custom-bet { padding: 10px; background: #111; border: 1px solid #444; color: #aaa; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; }
  .active-bet { color: #000 !important; border-color: gold !important; background: gold !important; }
  
  #confirm { margin-bottom: 10px; padding: 12px 30px; background: #00c853; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; width: 90%; max-width: 320px; }
  #confirm:disabled { background: #666; cursor: not-allowed; }
  
  .finance-area { display: flex; gap: 10px; width: 90%; max-width: 320px; margin-bottom: 15px; }
  .btn-finance { flex: 1; padding: 12px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }
  .btn-dep { background: #ffd700; color: #000; box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  .btn-saq { background: #2979ff; color: #fff; }

  #canvas-container { position: relative; display: inline-block; margin-top: 10px; }
  canvas { background: radial-gradient(circle, #0e4422 0%, #052b14 100%); border: 10px solid #3e2723; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); display: block; cursor: none; }

  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
  .modal-content { background: #1a1a1a; padding: 20px; border-radius: 12px; border: 1px solid gold; width: 85%; max-width: 320px; text-align: center; }
  .modal-content input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; outline: none; }
</style>
</head>
<body>

<div class="header">
  <div class="stat-box"><span class="stat-label">Saldo</span><span id="saldo" class="stat-value">R$ 0.00</span></div>
  <div class="stat-box"><span class="stat-label">Retorno (3.0x)</span><span id="lucro" class="stat-value" style="color:#0f0">R$ 30.00</span></div>
  <div class="stat-box"><span class="stat-label">Tempo</span><span id="tempo" class="stat-value" style="color:#ff4444">2.50</span></div>
</div>

<div id="bet-panel">
  <button class="bet-btn active-bet" onclick="selectBet(10,this)">R$ 10</button>
  <button class="bet-btn" onclick="selectBet(20,this)">R$ 20</button>
  <button class="bet-btn" onclick="selectBet(50,this)">R$ 50</button>
  <input type="number" id="custom-bet" placeholder="VALOR" oninput="updateCustom(this.value)">
</div>

<button id="confirm" onclick="confirmBet()">Confirmar Aposta</button>

<div class="finance-area">
  <button class="btn-finance btn-dep" onclick="abrirModal('deposito')">üì• Dep√≥sito</button>
  <button class="btn-finance btn-saq" onclick="abrirModal('saque')">üì§ Saque</button>
</div>

<div id="canvas-container">
  <canvas id="game"></canvas>
  <svg id="slingshot" width="100%" height="100%" style="position: absolute; top: 0; left: 0; pointer-events: none; display: none; z-index: 50;">
    <!-- Linha √∫nica do estilingue -->
    <line id="aim-line" x1="0" y1="0" x2="0" y2="0" stroke="#FFD700" stroke-width="1.5" opacity="0.4" stroke-dasharray="3,2"/>
  </svg>
</div>

<div id="modalFinanceiro" class="modal">
  <div class="modal-content">
    <div id="conteudo-modal"></div>
    <button onclick="fecharModal()" style="color:#888; background:none; border:none; margin-top:15px; font-size: 12px;">[ FECHAR JANELA ]</button>
  </div>
</div>

<script>
let usuarioLogado = localStorage.getItem("usuario");
let valorAposta = 10;
let dificuldadeRTP = 0.95;
let jogoAtivo = false;
let apostando = false;
let bolaMovida = false;
let velocidadeBranca = { x: 0, y: 0 };
let velocidadeDourada = { x: 0, y: 0 };
let atrito = 0.995;
let gameLoopRunning = false;
let lastBetTimestamp = 0;
let tempoJogo = 0;
let tempoMaximo = 2.5;
let timerAtivo = false;

const CANVAS_BORDER_WIDTH = 10; // canvas CSS border (px), used to sync SVG overlay coordinates
const BALANCE_SYNC_COOLDOWN_MS = 10000; // ms to block interval sync after a bet response

// Vari√°veis para o estilingue
let touchStartX = 0;
let touchStartY = 0;
let isTouching = false;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const slingshot = document.getElementById("slingshot");
const aimLine = document.getElementById("aim-line");

canvas.width = window.innerWidth * 0.94;
canvas.height = canvas.width * 0.80;

let branca = { x: 0, y: 0, r: 8 }, 
    dourada = { x: 0, y: 0, r: 8 }, 
    hole = { x: 0, y: 0, r: 10 };

/* ===== INICIALIZAR POSI√á√ïES =====*/
function sortearPosicoes() {
    const m = 0; 
    const cantos = [
        {x: m, y: m}, 
        {x: canvas.width - m, y: m}, 
        {x: m, y: canvas.height - m}, 
        {x: canvas.width - m, y: canvas.height - m}
    ];
    hole = cantos[Math.floor(Math.random() * 4)];
    hole.r = 16;

    const centroX = canvas.width / 2;
    const centroY = canvas.height / 2;

    dourada.x = (hole.x < centroX) ? centroX + 40 : centroX - 40;
    dourada.y = (hole.y < centroY) ? centroY + 40 : centroY - 40;

    branca.x = dourada.x + (hole.x < centroX ? 70 : -70);
    branca.y = dourada.y + (hole.y < centroY ? 70 : -70);

    velocidadeBranca = { x: 0, y: 0 };
    velocidadeDourada = { x: 0, y: 0 };
    bolaMovida = false;
    jogoAtivo = false;
    tempoJogo = 0;
    timerAtivo = false;
    isTouching = false;
    
    desenhar();
}

/* ===== DESENHAR JOGO =====*/
function desenhar() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Desenhar CA√áAPA
    ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
    ctx.beginPath();
    ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.strokeStyle = "#FF8C00";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.arc(hole.x, hole.y, hole.r, 0, Math.PI * 2);
    ctx.stroke();
    
    ctx.strokeStyle = "#FFD700";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(hole.x, hole.y, hole.r - 3, 0, Math.PI * 2);
    ctx.stroke();
    
    // Desenhar bola branca
    ctx.fillStyle = "#fff"; 
    ctx.beginPath(); 
    ctx.arc(branca.x, branca.y, branca.r, 0, Math.PI * 2); 
    ctx.fill();
    
    ctx.strokeStyle = "#888";
    ctx.lineWidth = 1;
    ctx.stroke();
    
    // Brilho na bola branca
    ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
    ctx.beginPath();
    ctx.arc(branca.x - 3, branca.y - 3, 3, 0, Math.PI * 2);
    ctx.fill();
    
    // Desenhar bola dourada
    ctx.fillStyle = "#FFD700"; 
    ctx.beginPath(); 
    ctx.arc(dourada.x, dourada.y, dourada.r, 0, Math.PI * 2); 
    ctx.fill();
    
    ctx.strokeStyle = "#FFA500";
    ctx.lineWidth = 1;
    ctx.stroke();
    
    // Brilho na bola dourada
    ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
    ctx.beginPath();
    ctx.arc(dourada.x - 3, dourada.y - 3, 3, 0, Math.PI * 2);
    ctx.fill();
}

/* ===== PHYSICS DO JOGO =====*/
function atualizarFisica() {
    if (!jogoAtivo) return;

    if (timerAtivo) {
        tempoJogo += 1/60;
        const tempoRestante = Math.max(0, tempoMaximo - tempoJogo);
        document.getElementById("tempo").innerText = tempoRestante.toFixed(2);
        
        if (tempoJogo >= tempoMaximo) {
            timerAtivo = false;
            jogoAtivo = false;
            finalizarJogo(false);
            return;
        }
    }

    // Aplicar atrito
    velocidadeBranca.x *= atrito;
    velocidadeBranca.y *= atrito;
    velocidadeDourada.x *= atrito;
    velocidadeDourada.y *= atrito;

    // Mover bola branca
    branca.x += velocidadeBranca.x;
    branca.y += velocidadeBranca.y;

    // Mover bola dourada
    dourada.x += velocidadeDourada.x;
    dourada.y += velocidadeDourada.y;

    // Colis√£o com paredes - BRANCA
    if (branca.x - branca.r < 0) { 
        branca.x = branca.r; 
        velocidadeBranca.x *= -0.7; 
    }
    if (branca.x + branca.r > canvas.width) { 
        branca.x = canvas.width - branca.r; 
        velocidadeBranca.x *= -0.7; 
    }
    if (branca.y - branca.r < 0) { 
        branca.y = branca.r; 
        velocidadeBranca.y *= -0.7; 
    }
    if (branca.y + branca.r > canvas.height) { 
        branca.y = canvas.height - branca.r; 
        velocidadeBranca.y *= -0.7; 
    }

    // Colis√£o com paredes - DOURADA
    if (dourada.x - dourada.r < 0) { 
        dourada.x = dourada.r; 
        velocidadeDourada.x *= -0.7; 
    }
    if (dourada.x + dourada.r > canvas.width) { 
        dourada.x = canvas.width - dourada.r; 
        velocidadeDourada.x *= -0.7; 
    }
    if (dourada.y - dourada.r < 0) { 
        dourada.y = dourada.r; 
        velocidadeDourada.y *= -0.7; 
    }
    if (dourada.y + dourada.r > canvas.height) { 
        dourada.y = canvas.height - dourada.r; 
        velocidadeDourada.y *= -0.7; 
    }

    // Colis√£o entre as bolas
    const dx = dourada.x - branca.x;
    const dy = dourada.y - branca.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    const minDist = branca.r + dourada.r + 2;
    
    if (dist < minDist && dist > 0) {
        const overlap = minDist - dist;
        const ux = dx / dist;
        const uy = dy / dist;
        
        branca.x -= (ux * overlap * 0.5);
        branca.y -= (uy * overlap * 0.5);
        dourada.x += (ux * overlap * 0.5);
        dourada.y += (uy * overlap * 0.5);
        
        const vx1 = velocidadeBranca.x;
        const vy1 = velocidadeBranca.y;
        const vx2 = velocidadeDourada.x;
        const vy2 = velocidadeDourada.y;
        
        const v_rel_x = vx1 - vx2;
        const v_rel_y = vy1 - vy2;
        
        const v_dot = v_rel_x * ux + v_rel_y * uy;
        
        if (v_dot > 0) {
            velocidadeBranca.x -= (v_dot * ux) * 0.9;
            velocidadeBranca.y -= (v_dot * uy) * 0.9;
            velocidadeDourada.x += (v_dot * ux) * 0.9;
            velocidadeDourada.y += (v_dot * uy) * 0.9;
        }
    }

    // Verificar se bola dourada entrou na ca√ßapa
    const dxHole = hole.x - dourada.x;
    const dyHole = hole.y - dourada.y;
    const distHole = Math.sqrt(dxHole * dxHole + dyHole * dyHole);

    if (distHole < hole.r) {
        finalizarJogo(true);
        return;
    }

    // Parar jogo apenas se bola foi movida E velocidade muito baixa
    const velocidade = Math.sqrt(velocidadeBranca.x ** 2 + velocidadeBranca.y ** 2);
    
    if (bolaMovida && velocidade < 0.2) {
        velocidadeBranca.x = 0;
        velocidadeBranca.y = 0;
        velocidadeDourada.x = 0;
        velocidadeDourada.y = 0;
        jogoAtivo = false;
        timerAtivo = false;
        
        setTimeout(() => {
            if (apostando && !jogoAtivo) {
                finalizarJogo(false);
            }
        }, 1000);
        return;
    }

    desenhar();
}

/* ===== ESTILINGUE (SLINGSHOT) - TOUCH START =====*/
canvas.addEventListener("touchstart", (e) => {
    if (!jogoAtivo || bolaMovida) return;
    
    e.preventDefault();
    
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    
    touchStartX = touch.clientX - rect.left;
    touchStartY = touch.clientY - rect.top;
    isTouching = true;
    timerAtivo = true;
    
    slingshot.style.display = "block";
});

/* ===== ESTILINGUE (SLINGSHOT) - TOUCH MOVE =====*/
canvas.addEventListener("touchmove", (e) => {
    if (!jogoAtivo || !isTouching || bolaMovida) return;
    
    e.preventDefault();
    
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const currentX = touch.clientX - rect.left;
    const currentY = touch.clientY - rect.top;
    
    // Calcular dist√¢ncia e √¢ngulo entre toque inicial e atual
    const dx = currentX - touchStartX;
    const dy = currentY - touchStartY;
    
    // Vetor invertido (estilingue puxa para tr√°s)
    const invertedX = -dx;
    const invertedY = -dy;
    
    // Calcular comprimento da linha at√© a bola dourada
    const distToBall = Math.sqrt(
        Math.pow(dourada.x - branca.x, 2) + 
        Math.pow(dourada.y - branca.y, 2)
    );
    
    // Normalizar e estender at√© passar um pouco da bola dourada
    const dist = Math.sqrt(invertedX * invertedX + invertedY * invertedY);
    if (dist > 10) {
        const normalized = 1 / dist;
        const lineLength = distToBall + 15; // Passa 15px al√©m da bola dourada
        const endX = branca.x + (invertedX * normalized * lineLength);
        const endY = branca.y + (invertedY * normalized * lineLength);
        const border = CANVAS_BORDER_WIDTH;
        aimLine.setAttribute("x1", branca.x + border);
        aimLine.setAttribute("y1", branca.y + border);
        aimLine.setAttribute("x2", endX + border);
        aimLine.setAttribute("y2", endY + border);
    }
});

/* ===== ESTILINGUE (SLINGSHOT) - TOUCH END =====*/
canvas.addEventListener("touchend", (e) => {
    if (!jogoAtivo || !isTouching || bolaMovida) {
        slingshot.style.display = "none";
        isTouching = false;
        return;
    }
    
    e.preventDefault();
    
    // Calcular for√ßa final
    const touch = e.changedTouches[0];
    const rect = canvas.getBoundingClientRect();
    const endX = touch.clientX - rect.left;
    const endY = touch.clientY - rect.top;
    
    // Deslocamento do toque
    const dx = endX - touchStartX;
    const dy = endY - touchStartY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    
    // Aplicar for√ßa na dire√ß√£o OPOSTA
    if (dist > 5) {
        const forceStrength = Math.min(dist / 10, 25);
        const angle = Math.atan2(-dy, -dx);
        
        velocidadeBranca.x = Math.cos(angle) * forceStrength;
        velocidadeBranca.y = Math.sin(angle) * forceStrength;
        
        bolaMovida = true;
        timerAtivo = true;
    }
    
    slingshot.style.display = "none";
    isTouching = false;
});

/* ===== MOUSE - PARA DESKTOP =====*/
let mousePressed = false;

canvas.addEventListener("mousedown", (e) => {
    if (!jogoAtivo || bolaMovida) return;
    
    const rect = canvas.getBoundingClientRect();
    touchStartX = e.clientX - rect.left;
    touchStartY = e.clientY - rect.top;
    isTouching = true;
    mousePressed = true;
    timerAtivo = true;
    
    slingshot.style.display = "block";
});

document.addEventListener("mousemove", (e) => {
    if (!jogoAtivo || !mousePressed || bolaMovida) return;
    
    const rect = canvas.getBoundingClientRect();
    const currentX = e.clientX - rect.left;
    const currentY = e.clientY - rect.top;
    
    const dx = currentX - touchStartX;
    const dy = currentY - touchStartY;
    
    const invertedX = -dx;
    const invertedY = -dy;
    
    const distToBall = Math.sqrt(
        Math.pow(dourada.x - branca.x, 2) + 
        Math.pow(dourada.y - branca.y, 2)
    );
    
    const dist = Math.sqrt(invertedX * invertedX + invertedY * invertedY);
    if (dist > 10) {
        const normalized = 1 / dist;
        const lineLength = distToBall + 15;
        const endX = branca.x + (invertedX * normalized * lineLength);
        const endY = branca.y + (invertedY * normalized * lineLength);
        const border = CANVAS_BORDER_WIDTH;
        aimLine.setAttribute("x1", branca.x + border);
        aimLine.setAttribute("y1", branca.y + border);
        aimLine.setAttribute("x2", endX + border);
        aimLine.setAttribute("y2", endY + border);
    }
});

document.addEventListener("mouseup", (e) => {
    if (!jogoAtivo || !mousePressed || bolaMovida) {
        slingshot.style.display = "none";
        mousePressed = false;
        isTouching = false;
        return;
    }
    
    const rect = canvas.getBoundingClientRect();
    const endX = e.clientX - rect.left;
    const endY = e.clientY - rect.top;
    
    const dx = endX - touchStartX;
    const dy = endY - touchStartY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    
    if (dist > 5) {
        const forceStrength = Math.min(dist / 10, 25);
        const angle = Math.atan2(-dy, -dx);
        
        velocidadeBranca.x = Math.cos(angle) * forceStrength;
        velocidadeBranca.y = Math.sin(angle) * forceStrength;
        
        bolaMovida = true;
        timerAtivo = true;
    }
    
    slingshot.style.display = "none";
    mousePressed = false;
    isTouching = false;
});

/* ===== ATUALIZAR SALDO =====*/
async function atualizarSaldoDoServidor() {
    // Skip interval update if a bet response recently updated the balance (within 10 seconds)
    if (Date.now() - lastBetTimestamp < BALANCE_SYNC_COOLDOWN_MS) return;
    try {
        const res = await fetch(`/api/saldo?user=${usuarioLogado}`);
        const data = await res.json();
        if(data.success) {
            document.getElementById("saldo").innerText = `R$ ${parseFloat(data.saldo).toFixed(2)}`;
        }
    } catch (e) {
        console.log("Erro ao buscar saldo:", e);
    }
}

/* ===== GAME LOOP =====*/
function gameLoop() {
    atualizarFisica();
    if (gameLoopRunning) {
        requestAnimationFrame(gameLoop);
    }
}

/* NOVO CONFIRMAR APOSTA (Substitua no HTML) */
async function confirmBet() {
    const btnConfirm = document.getElementById("confirm");
    btnConfirm.disabled = true;

    try {
        const res = await fetch("/api/aposta", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username: usuarioLogado, valor: valorAposta })
        });

        const data = await res.json();
        
        if (!data.success) {
            alert("‚ùå " + (data.message || "Erro na aposta"));
            btnConfirm.disabled = false;
            return;
        }

        // O SERVIDOR J√Å DECIDIU AQUI SE ELE GANHOU OU PERDEU
        window.resultadoFinal = data.ganhou; 
        lastBetTimestamp = Date.now();
        document.getElementById("saldo").innerText = `R$ ${data.saldo.toFixed(2)}`;

        sortearPosicoes();
        jogoAtivo = true;
        apostando = true;
        
        if (!gameLoopRunning) {
            gameLoopRunning = true;
            requestAnimationFrame(gameLoop);
        }

        alert("‚úÖ Aposta Confirmada! Boa sorte!");
        
    } catch (e) {
        alert("‚ùå Erro de conex√£o");
        if (!gameLoopRunning) {
            btnConfirm.disabled = false;
        }
    }
}

/* NOVO FINALIZAR JOGO (Substitua no HTML) */
function finalizarJogo(ganhouVisivel) {
    jogoAtivo = false;
    timerAtivo = false;

    if (!ganhouVisivel) {
        // Bola n√£o entrou na ca√ßapa
        alert("‚ùå N√£o foi dessa vez!");
    } else if (ganhouVisivel && window.resultadoFinal) {
        // ‚úÖ Bola entrou E servidor confirmou vit√≥ria
        const ganhoTotal = valorAposta * 3;
        alert(`üéâ VIT√ìRIA! Voc√™ ganhou R$ ${ganhoTotal.toFixed(2)}`);

        // Refetch do saldo ap√≥s 2 segundos para sincronizar com o servidor
        setTimeout(() => {
            atualizarSaldoDoServidor();
        }, 2000);
    } else if (ganhouVisivel && !window.resultadoFinal) {
        // Anti-cheat: bola entrou mas servidor disse que perdeu
        alert("‚ö†Ô∏è Lance inv√°lido ou tempo expirado!");
    }

    apostando = false;
    gameLoopRunning = false;
    document.getElementById("confirm").disabled = false;
    setTimeout(sortearPosicoes, 1000);
}

function atualizarLucro() {
    document.getElementById("lucro").innerText = `R$ ${(valorAposta * 3).toFixed(2)}`;
}

function selectBet(v, btn) {
    valorAposta = v;
    document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active-bet'));
    btn.classList.add('active-bet');
    atualizarLucro();
    document.getElementById('custom-bet').value = '';
}

function updateCustom(val) {
    if (val) {
        valorAposta = parseFloat(val) || 0;
        document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active-bet'));
        atualizarLucro();
    }
}

function abrirModal(tipo) {
    const modal = document.getElementById("modalFinanceiro");
    const cont = document.getElementById("conteudo-modal");
    modal.style.display = "flex";
    if(tipo === 'deposito') {
        cont.innerHTML = `<h2>Dep√≥sito PIX</h2><input type="number" id="vD" placeholder="Valor R$"><div id="qR"></div><button onclick="gerarPix()" style="width:100%; padding:12px; background:gold; border:none; font-weight:bold; border-radius:6px;">Gerar QR Code</button>`;
    } else {
        cont.innerHTML = `<h2>Sacar Saldo</h2><input type="number" id="vS" placeholder="Valor R$"><input type="text" id="cP" placeholder="Chave PIX"><button onclick="fazerSaque()" style="width:100%; padding:12px; background:#2979ff; color:#fff; border:none; font-weight:bold; border-radius:6px;">Solicitar Saque</button>`;
    }
}

async function gerarPix() {
    const valor = document.getElementById("vD").value;
    if(!valor || valor < 1) return alert("Valor inv√°lido");
    document.getElementById("qR").innerHTML = "<p style='color:white'>Gerando...</p>";
    const res = await fetch("/api/gerar-deposito", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({username: usuarioLogado, valor})});
    const data = await res.json();
    if(data.success) {
        document.getElementById("qR").innerHTML = `<img src="data:image/png;base64,${data.qrCode}" width="180"><br><button class="btn-finance btn-dep" style="margin-top:10px; font-size:10px" onclick="atualizarSaldoDoServidor()">Atualizar Saldo</button>`;
    }
}

function fazerSaque() {
    const valor = document.getElementById("vS").value;
    const chave = document.getElementById("cP").value;
    if(!valor || !chave) return alert("Preencha todos os campos");
    alert("Saque solicitado com sucesso!");
    fecharModal();
    atualizarSaldoDoServidor();
}

function fecharModal() { 
    document.getElementById("modalFinanceiro").style.display = "none"; 
}

window.onload = () => { 
    sortearPosicoes(); 
    atualizarLucro();
    atualizarSaldoDoServidor();
    setInterval(atualizarSaldoDoServidor, 5000);
};
</script>
</body>
</html>
